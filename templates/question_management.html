<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Management - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            margin: 20px auto;
            max-width: 1200px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .question-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        .btn-action {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>üìù Question Management</h2>
            <a href="/admin/dashboard" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Back to Dashboard
            </a>
        </div>
        
        <!-- Add Question Section -->
        <div class="question-card">
            <h4><i class="bi bi-plus-circle text-primary"></i> Add Questions</h4>
            <p>Create new quiz questions</p>
            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">Question Text</label>
                    <textarea class="form-control" id="questionText" rows="3" placeholder="Enter your question here..."></textarea>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Options (comma separated)</label>
                    <input type="text" class="form-control" id="optionsText" placeholder="Option A, Option B, Option C, Option D">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-4">
                    <label class="form-label">Correct Answer</label>
                    <input type="text" class="form-control" id="correctAnswer" placeholder="A, B, C, or D">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Difficulty</label>
                    <select class="form-control" id="difficulty">
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Category</label>
                    <input type="text" class="form-control" id="category" placeholder="General, Science, History, etc.">
                </div>
            </div>
            <button class="btn btn-primary btn-lg mt-3" onclick="addQuestion()">
                <i class="bi bi-plus-circle"></i> Add Question
            </button>
        </div>
        
        <!-- Edit/Delete Questions Section -->
        <div class="question-card">
            <h4><i class="bi bi-pencil-square text-warning"></i> Edit & Delete Questions</h4>
            <p>Modify or remove existing questions</p>
            <div class="mb-3">
                <input type="text" class="form-control" id="searchQuestions" placeholder="Search questions...">
                <button class="btn btn-secondary btn-action" onclick="searchQuestions()">
                    <i class="bi bi-search"></i> Search
                </button>
                <button class="btn btn-success btn-action" onclick="loadQuestions()">
                    <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
            </div>
            <div id="questionsList" style="max-height: 400px; overflow-y: auto;">
                <!-- Questions will be loaded here -->
            </div>
        </div>
    </div>
    
    <div id="alertContainer" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let questions = [];
        
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alertContainer');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type === 'error' ? 'danger' : 'success'} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert">√ó</button>
            `;
            alertDiv.style.cssText = 'margin-bottom: 10px; border-radius: 5px;';
            alertContainer.appendChild(alertDiv);
            setTimeout(() => alertDiv.remove(), 5000);
        }
        
        async function loadQuestions() {
            try {
                const response = await fetch('/api/admin/questions');
                const data = await response.json();
                
                if (data.error) {
                    showAlert('Error loading questions: ' + data.error, 'error');
                    return;
                }
                
                questions = data.questions || [];
                displayQuestions();
                showAlert('Questions loaded successfully!', 'success');
                
            } catch (error) {
                showAlert('Failed to load questions: ' + error.message, 'error');
            }
        }
        
        function displayQuestions() {
            const container = document.getElementById('questionsList');
            container.innerHTML = questions.map((q, index) => `
                <div class="question-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div style="flex: 1;">
                            <h6>Question ${index + 1}: ${q.question}</h6>
                            <p class="text-muted mb-2">
                                <strong>Options:</strong> ${q.options.join(', ')}<br>
                                <strong>Correct:</strong> ${q.correct}<br>
                                <strong>Difficulty:</strong> ${q.difficulty}<br>
                                <strong>Category:</strong> ${q.category || 'General'}
                            </p>
                        </div>
                        <div>
                            <button class="btn btn-warning btn-sm btn-action" onclick="editQuestion(${index})">
                                <i class="bi bi-pencil"></i> Edit
                            </button>
                            <button class="btn btn-danger btn-sm btn-action" onclick="deleteQuestion(${index})">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function addQuestion() {
            const questionText = document.getElementById('questionText').value.trim();
            const optionsText = document.getElementById('optionsText').value.trim();
            const correctAnswer = document.getElementById('correctAnswer').value.trim();
            const difficulty = document.getElementById('difficulty').value;
            const category = document.getElementById('category').value.trim();
            
            if (!questionText || !optionsText || !correctAnswer) {
                showAlert('Please fill in all required fields', 'error');
                return;
            }
            
            const options = optionsText.split(',').map(opt => opt.trim()).filter(opt => opt);
            
            const newQuestion = {
                question: questionText,
                options: options,
                correct: correctAnswer,
                difficulty: difficulty,
                category: category || 'General'
            };
            
            questions.push(newQuestion);
            displayQuestions();
            clearForm();
            showAlert('Question added successfully!', 'success');
        }
        
        function editQuestion(index) {
            const q = questions[index];
            document.getElementById('questionText').value = q.question;
            document.getElementById('optionsText').value = q.options.join(', ');
            document.getElementById('correctAnswer').value = q.correct;
            document.getElementById('difficulty').value = q.difficulty;
            document.getElementById('category').value = q.category || '';
            
            // Change button to update
            const addBtn = document.querySelector('button[onclick="addQuestion()"]');
            addBtn.innerHTML = '<i class="bi bi-check-circle"></i> Update Question';
            addBtn.onclick = () => updateQuestion(index);
            
            showAlert('Question loaded for editing', 'info');
        }
        
        function updateQuestion(index) {
            const questionText = document.getElementById('questionText').value.trim();
            const optionsText = document.getElementById('optionsText').value.trim();
            const correctAnswer = document.getElementById('correctAnswer').value.trim();
            const difficulty = document.getElementById('difficulty').value;
            const category = document.getElementById('category').value.trim();
            
            if (!questionText || !optionsText || !correctAnswer) {
                showAlert('Please fill in all required fields', 'error');
                return;
            }
            
            const options = optionsText.split(',').map(opt => opt.trim()).filter(opt => opt);
            
            questions[index] = {
                question: questionText,
                options: options,
                correct: correctAnswer,
                difficulty: difficulty,
                category: category || 'General'
            };
            
            displayQuestions();
            clearForm();
            resetAddButton();
            showAlert('Question updated successfully!', 'success');
        }
        
        function deleteQuestion(index) {
            if (confirm('Are you sure you want to delete this question?')) {
                questions.splice(index, 1);
                displayQuestions();
                showAlert('Question deleted successfully!', 'success');
            }
        }
        
        function searchQuestions() {
            const searchTerm = document.getElementById('searchQuestions').value.toLowerCase();
            const filteredQuestions = questions.filter(q => 
                q.question.toLowerCase().includes(searchTerm) ||
                q.category.toLowerCase().includes(searchTerm)
            );
            
            const container = document.getElementById('questionsList');
            if (filteredQuestions.length === 0) {
                container.innerHTML = '<p class="text-muted">No questions found</p>';
            } else {
                questions = filteredQuestions;
                displayQuestions();
            }
        }
        
        function clearForm() {
            document.getElementById('questionText').value = '';
            document.getElementById('optionsText').value = '';
            document.getElementById('correctAnswer').value = '';
            document.getElementById('difficulty').value = 'easy';
            document.getElementById('category').value = '';
        }
        
        function resetAddButton() {
            const addBtn = document.querySelector('button[onclick*="updateQuestion"]');
            addBtn.innerHTML = '<i class="bi bi-plus-circle"></i> Add Question';
            addBtn.onclick = addQuestion;
        }
        
        // Load questions when page loads
        document.addEventListener('DOMContentLoaded', loadQuestions);
    </script>
</body>
</html>
